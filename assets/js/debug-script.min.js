jQuery((function(e){if(e("#debug-tools .tool").on("click",'input[type="submit"]',(function(t){t.preventDefault();let n=e(this).closest("form"),a=n.find('input[name="debug_tool"]').val(),d=new FormData(n[0]);d.append("action","wpo_wcpdf_debug_tools"),d.append("nonce",wpo_wcpdf_debug.nonce),n.closest(".tool").block({message:null,overlayCSS:{background:"#fff",opacity:.6}});let o=!1;o="reset-settings"!==a||window.confirm(wpo_wcpdf_debug.confirm_reset),o&&e.ajax({url:wpo_wcpdf_debug.ajaxurl,data:d,type:"POST",cache:!1,processData:!1,contentType:!1,success(t){!function(t,n,a){let d=a.find("fieldset > .notice");if("export_settings"===(d.hide(),d.removeClass("notice-error"),d.removeClass("notice-success"),t))if(n.success&&n.data.filename&&n.data.settings){a.find(".download_file").remove();let t={type:a.find('select[name="type"').val(),settings:n.data.settings};t="data:text/plain;charset=utf-8,"+encodeURIComponent(JSON.stringify(t)),a.append(e('<div class="download_file"><label>'+wpo_wcpdf_debug.download_label+':</label> <a href="data:'+t+'" download="'+n.data.filename+'">'+n.data.filename+"</a></div>"))}else!n.success&&n.data.message&&(d.addClass("notice-error"),d.find("p").text(n.data.message),d.show());else n.success&&n.data.message?(d.addClass("notice-success"),a.find("> .notice-warning").remove()):!n.success&&n.data.message&&d.addClass("notice-error"),d.find("p").text(n.data.message),d.show()}(a,t,n),n.closest(".tool").unblock()},error(e,t,a){n.closest(".tool").unblock()}})})),e("[name='wpo_wcpdf_settings_debug[document_access_denied_redirect_page]']").on("change",(function(t){let n=e(this).closest("table").find("#document_custom_redirect_page"),a=n.closest("td").find(".description");"custom_page"===e(this).val()?(n.show(),a.show()):(n.hide(),a.hide())})).trigger("change"),!0===wpo_wcpdf_debug.danger_zone.enabled){let t='<div class="notice notice-warning inline"><p>'+wpo_wcpdf_debug.danger_zone.message+"</p></div>";e("input#enable_danger_zone_tools").closest("td").find(".description").append(t)}function t(n,a,d,o,s,l,c){let r={action:"wpo_wcpdf_danger_zone_tools",delete_or_renumber:c,document_type:n,date_type:a,date_from:d,date_to:o,page_count:s,document_count:l,nonce:wpo_wcpdf_debug.nonce};e.ajax({type:"POST",url:wpo_wcpdf_debug.ajaxurl,data:r,dataType:"json",success:function(r){if(!1===r.data.finished)s=r.data.pageCount,l=r.data.documentCount,t(n,a,d,o,s,l,c);else{e(".renumber-spinner, .delete-spinner").css("visibility","hidden"),e("#renumber-documents-btn, #delete-documents-btn").removeAttr("disabled"),e("#renumber-document-type, #renumber-date-from, #renumber-date-to, #delete-document-type, #delete-date-from, #delete-date-to").prop("disabled",!1);let t=r.data.message;alert(l+t)}},error:function(e,t,n){alert(e.status+":"+n)}})}function n(e){let t=window.location.href;return new URL(t).searchParams.get(e)}e(document.body).on("click","#wpo-wcpdf-settings a.number-search-button",(function(t){t.preventDefault();let n=e(this).closest("div").find(':input[name="number_search_input"]').val();window.location.href=window.location.href+"&s="+n})),e("#renumber-date-from, #renumber-date-to, #delete-date-from, #delete-date-to, #fetch-numbers-data-date-from, #fetch-numbers-data-date-to").datepicker({dateFormat:"yy-mm-dd"}),e(document.body).on("click","#debug-tools .number-tools-btn",(function(n){n.preventDefault();let a="",d="",o="",s="";"renumber-documents-btn"===this.id?(a=e("#renumber-document-type").val(),dateType=e("#renumber-date-type").val(),d=e("#renumber-date-from").val(),o=e("#renumber-date-to").val(),s="renumber"):"delete-documents-btn"===this.id&&(a=e("#delete-document-type").val(),dateType=e("#delete-date-type").val(),d=e("#delete-date-from").val(),o=e("#delete-date-to").val(),s="delete"),""!==a&&"undefined"!==a?("renumber"===s?e(".renumber-spinner").css("visibility","visible"):"delete"===s&&e(".delete-spinner").css("visibility","visible"),e("#renumber-documents-btn, #delete-documents-btn").attr("disabled",!0),e("#renumber-document-type, #renumber-date-from, #renumber-date-to, #delete-document-type, #delete-date-from, #delete-date-to").prop("disabled",!0),t(a,dateType,d,o,1,0,s)):alert(wpo_wcpdf_debug.select_document_type)})),e("#debug-tools #delete-document-type").on("change",(function(t){t.preventDefault(),"all"===e(this).val()?e(this).closest("form").find('#delete-date-type option[value="document_date"]').prop("disabled",!0):e(this).closest("form").find('#delete-date-type option[value="document_date"]').prop("disabled",!1)})).trigger("change"),e("#debug-tools #delete-date-type").on("change",(function(t){t.preventDefault();let n=e(this).closest("form").find("#delete-document-type");""===n.val()||"all"===n.val()?e(this).find('option[value="document_date"]').prop("disabled",!0):e(this).find('option[value="document_date"]').prop("disabled",!1)})).trigger("change"),e("#wpo-wcpdf-settings").on("click","#fetch-numbers-data, #delete-numbers-data",(function(t){t.preventDefault();let a=e(this),d=a.data("table_name"),o=a.data("operation"),s=a.closest(".number-table-data-info").find("#fetch-numbers-data-date-from").val(),l=a.closest(".number-table-data-info").find("#fetch-numbers-data-date-to").val(),c=n("order"),r=n("orderby");a.closest(".wcpdf_advanced_numbers_choose_table").block({message:null,overlayCSS:{background:"#fff",opacity:.6}}),e.ajax({url:wpo_wcpdf_debug.ajaxurl,data:{action:"wpo_wcpdf_numbers_data",nonce:wpo_wcpdf_debug.nonce,table_name:d,operation:o,order:c,orderby:r,from:s,to:l},type:"POST",success:function(e){e.success?window.location.replace(e.data):location.reload()},error:function(e,t,n){alert(e.status+":"+n),a.closest(".wcpdf_advanced_numbers_choose_table").unblock()}})}))}));
