jQuery((function(t){t('select[name^="wpo_ips_edi_tax_settings"][name$="[scheme]"],\n\t\tselect[name^="wpo_ips_edi_tax_settings"][name$="[category]"],\n\t\tselect[name^="wpo_ips_edi_tax_settings"][name$="[reason]"]').on("change",(function(){let e=t(this).data("current"),a=t(this).find("option:selected").val(),s=t(this).closest("td, th, div").find(".current"),o=`${wpo_ips_edi.new}: <code>${a}</code> <strong>(${wpo_ips_edi.unsaved})</strong>`,n=`${wpo_ips_edi.code}: <code>${e}</code>`;if(a!==e?s.html(o):s.html(n),t(this).attr("name").endsWith("[reason]")){let e=wpo_ips_edi.remarks.reason[a];e?t(this).closest("tr").find(".remark").html(e):t(this).closest("tr").find(".remark").html("")}}));const e=t(".edi-tax-class-group"),a=e.find(".doc-output-toggle"),s=t(".edi-tax-class-table");function o(t){t&&(s.hide().filter(`[data-tax-class="${t}"]`).show(),a.removeClass("active").attr("aria-pressed","false").filter(`[data-tax-class="${t}"]`).addClass("active").attr("aria-pressed","true"))}e.on("click",".doc-output-toggle",(function(e){e.preventDefault(),o(t(this).data("tax-class"))}));function n(){const e=t("#edi-customer-order-id"),a=e.val(),s=e.closest("table").find("tbody");if(!a)return s.empty().append(`<tr><td colspan="2">${wpo_ips_edi.enter_order_id}</td></tr>`),!1;const o=t.trim(a);return isNaN(o)||""===o?(s.empty().append(`<tr><td colspan="2">${wpo_ips_edi.valid_number}</td></tr>`),!1):(s.empty().append(`<tr><td colspan="2">${wpo_ips_edi.loading}</td></tr>`),t.get(wpo_ips_edi.ajaxurl,{action:"wpo_ips_edi_load_customer_order_identifiers",nonce:wpo_ips_edi.nonce,order_id:a},(function(e){if(s.empty(),e.success&&e.data&&e.data.data&&Object.keys(e.data.data).length>0){const a=e.data.data;t.each(a,(function(t,e){let a=e.label||t,o=e.value,n="",i="";var d;null!=o&&""!==o||(n=e.required?"#d63638":"#996800",o=`<span style="color:${n};">${e.required?wpo_ips_edi.missing:wpo_ips_edi.optional}</span>`),"vat_number"===t&&e.value&&(d=e.value,!/^[A-Z]{2}/.test(d))&&(i=`<br><small style="color:#996800;">${wpo_ips_edi.vat_warning}</small>`),s.append(`\n\t\t\t\t\t\t<tr>\n\t\t\t\t\t\t\t<td>${a}</td>\n\t\t\t\t\t\t\t<td>${o}${i}</td>\n\t\t\t\t\t\t</tr>\n\t\t\t\t\t`)}))}else{const t=e.data||wpo_ips_edi.no_identifiers_found;s.append(`<tr><td colspan="2">${t}</td></tr>`)}})),!1)}o(a.filter(".active").data("tax-class")||a.first().data("tax-class")||s.first().data("tax-class")),t("button.button-edi-save-taxes").on("click",(function(e){e.preventDefault();const a=t(this),s=a.data("nonce"),o=a.data("action"),n=a.closest("form#wpo-wcpdf-settings"),i=n.serialize()+"&action="+encodeURIComponent(o)+"&nonce="+encodeURIComponent(s),d=t("#edi-tax-save-notice");n.block({message:null,overlayCSS:{background:"#fff",opacity:.6}}),t.post(wpo_ips_edi.ajaxurl,i,(function(e){const a=e.data||"Unknown response.";let s="notice";e.success?s+=" notice-success":s+=" notice-error",d.removeClass().addClass(s).html(`<p><strong>${a}</strong></p>`).slideDown(),setTimeout((function(){d.slideUp()}),8e3),e.success&&function(){const e=t(".edi-tax-class-group .doc-output-toggle.active").data("tax-class")||t(".edi-tax-class-group .doc-output-toggle").first().data("tax-class")||t(".edi-tax-class-table:visible").data("tax-class")||t(".edi-tax-class-table").first().data("tax-class");t.get(wpo_ips_edi.ajaxurl,{action:"wpo_ips_edi_reload_tax_table",nonce:wpo_ips_edi.nonce,tax_class:e},(function(a){t(`.edi-tax-class-table[data-tax-class="${e}"]`).html(a)}))}(),n.unblock()}))})),t("#edi-customer-order-id").on("keydown",(function(t){"Enter"!==t.key&&13!==t.keyCode||(t.preventDefault(),n())})),t("#edi-customer-order-id-search-button").on("click",(function(t){t.preventDefault(),n()}))}));
